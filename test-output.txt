
> kapi-s-rpg@0.1.0 test
> jest --testPathPattern=time-manager --coverage --coveragePathIgnore=node_modules

PASS tests/calendar/time-manager.test.js
  TimeManager
    Constructor
      √ should initialize with default date-fns (8 ms)
      √ should accept dependency injection (1 ms)
    addMinutes()
      √ should add minutes to same day (4 ms)
      √ should handle midnight rollover (2 ms)
      √ should handle month-end rollover (1 ms)
      √ should handle year-end rollover (1 ms)
      √ should reject invalid date format (1 ms)
      √ should reject invalid time format (2 ms)
      √ should reject invalid minutes (2 ms)
    formatTimestamp()
      √ should format date and time with space separator (1 ms)
      √ should format with leading zeros (1 ms)
    advanceTime()
      √ should advance time and update calendar (2 ms)
      √ should not mutate input calendar (2 ms)
      √ should update day_of_week when date changes (2 ms)
      √ should update season when month changes (1 ms)
      √ should reject invalid calendar
      √ should reject non-positive minutes (1 ms)
      √ should reject minutes > 1 week
    calculateElapsed()
      √ should calculate same day elapsed time (1 ms)
      √ should calculate across midnight (1 ms)
      √ should calculate across multiple days (1 ms)
      √ should return negative if end < start (1 ms)
      √ should reject invalid start date (1 ms)
      √ should reject invalid end time (1 ms)
    parseDuration()
      √ should parse "2 hours" (2 ms)
      √ should parse "30 minutes" (1 ms)
      √ should parse "1 day" (1 ms)
      √ should parse "2 days"
      √ should parse "1 hour 30 minutes"
      √ should parse "8 hours" (long rest) (1 ms)
      √ should handle singular "minute" (1 ms)
      √ should handle "min" abbreviation (1 ms)
      √ should reject invalid format (1 ms)
      √ should reject empty string (1 ms)
      √ should reject durations > 1 week (1 ms)
    getActionDuration()
      √ should return travel duration from context.travelMinutes (1 ms)
      √ should return search duration (default × 3) (1 ms)
      √ should return dialogue duration (default × 1) (1 ms)
      √ should return short rest duration (60 min) (1 ms)
      √ should return long rest duration (480 min)
      √ should return 0 for combat (Epic 3)
      √ should return default for unknown action type (1 ms)
      √ should use default 10 if no calendar context (1 ms)
      √ should reject invalid action type (1 ms)
    Performance Tests
      √ addMinutes() should complete in < 50ms (2 ms)
      √ parseDuration() should complete in < 5ms (1 ms)

-----------------|---------|----------|---------|---------|-----------------------------------------------------------------------------
File             | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                           
-----------------|---------|----------|---------|---------|-----------------------------------------------------------------------------
All files        |   84.82 |    82.81 |     100 |   85.71 |                                                                             
 time-manager.js |   84.82 |    82.81 |     100 |   85.71 | 78,92,95,98,113,119,138,171,232,251,287,315,363,370,393,400,414,429,473,524 
-----------------|---------|----------|---------|---------|-----------------------------------------------------------------------------
Test Suites: 1 passed, 1 total
Tests:       46 passed, 46 total
Snapshots:   0 total
Time:        3.519 s, estimated 6 s
Ran all test suites matching /time-manager/i.
