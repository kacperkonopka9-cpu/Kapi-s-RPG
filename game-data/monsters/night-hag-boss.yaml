# Baba Lysaga - Legendary Night Hag (Boss Variant)
# Source: Curse of Strahd p.228
# Strahd's ancient nemesis, witch of incredible power, rider of the Creeping Hut

# === BASIC INFORMATION ===
name: "Baba Lysaga"
monsterId: "baba_lysaga"
size: "Medium"
type: "fiend"  # Enhanced night hag
subtype: "shapechanger"
alignment: "chaotic evil"

# === CHALLENGE RATING ===
challengeRating: 11
experiencePoints: 7200

# === ARMOR CLASS & HIT POINTS ===
armorClass: 18  # 17 natural armor + 1 ring of protection
armorType: "natural armor + ring of protection"

hitPoints:
  max: 150
  current: 150
  hitDice: "20d8"
  hitDiceBonus: 60  # +3 Con modifier * 20 HD = +60

# === ABILITY SCORES ===
abilities:
  strength: 20    # +5 (enhanced)
  dexterity: 17   # +3 (enhanced)
  constitution: 17  # +3 (enhanced)
  intelligence: 18  # +4 (enhanced)
  wisdom: 16     # +3 (enhanced)
  charisma: 18   # +4 (enhanced)

# === SPEEDS ===
speed:
  walk: 30
  fly: null  # 50 ft when riding Creeping Hut
  swim: null
  burrow: null
  climb: null

# === PROFICIENCIES & RESISTANCES ===
savingThrows:
  wisdom: 7      # +3 Wis + 4 prof
  charisma: 8    # +4 Cha + 4 prof

skills:
  arcana: 8        # +4 Int + 4 prof
  deception: 8     # +4 Cha + 4 prof
  insight: 7       # +3 Wis + 4 prof
  intimidation: 8  # +4 Cha + 4 prof
  perception: 7    # +3 Wis + 4 prof
  religion: 8      # +4 Int + 4 prof

damageVulnerabilities: []
damageResistances: ["cold", "fire", "lightning", "bludgeoning", "piercing", "slashing from nonmagical attacks that aren't silvered"]
damageImmunities: []
conditionImmunities: ["charmed", "frightened"]

# === SENSES ===
senses:
  darkvision: 120
  blindsight: null
  tremorsense: null
  truesight: null
  passivePerception: 17  # 10 + Perception (+7)

# === LANGUAGES ===
languages: ["Abyssal", "Common", "Draconic", "Dwarvish", "Giant", "Infernal", "Primordial", "Sylvan"]
languageNote: null

# === COMBAT MANAGER INTEGRATION ===
combatStats:
  id: "baba_lysaga_1"  # Boss encounter, single instance
  name: "Baba Lysaga"
  dexModifier: 3
  type: "monster"

# === SPECIAL TRAITS ===
traits:
  - name: "Blessing of Mother Night"
    description: "Baba Lysaga is shielded against divination magic, as though protected by a nondetection spell."
    mechanics:
      type: "divination_immunity"
      effect: "as_nondetection_spell"

  - name: "Shapechanger"
    description: "Baba Lysaga can use her action to polymorph into a Small or Medium female humanoid, or back into her true form. Her statistics are the same in each form. Any equipment she is wearing or carrying isn't transformed. She reverts to her true form if she dies."
    mechanics:
      type: "shapechange"
      actionCost: "action"
      forms: ["humanoid_female", "true_form"]
      sizeRange: ["Small", "Medium"]
      statsChange: "none"
      equipmentTransform: false
      deathReversion: "true_form"

  - name: "Magic Resistance"
    description: "Baba Lysaga has advantage on saving throws against spells and other magical effects."
    mechanics:
      type: "saving_throw_advantage"
      advantage: ["saves_vs_spells", "saves_vs_magical_effects"]

# === INNATE SPELLCASTING ===
innateSpellcasting:
  ability: "charisma"
  spellcastingDC: 16
  spellAttackBonus: 8
  componentRequirement: "none"
  spells:
    atWill: ["detect_magic", "magic_missile"]
    perDay:
      3: ["plane_shift_self_only", "ray_of_enfeeblement", "sleep"]
      1: ["etherealness"]

# === SPELLCASTING (WITCH OF INCREDIBLE POWER) ===
spellcasting:
  class: "witch"
  level: 16
  ability: "charisma"
  spellcastingDC: 16
  spellAttackBonus: 8
  spellSlots:
    level1: 4
    level2: 3
    level3: 3
    level4: 3
    level5: 2
    level6: 1
    level7: 1
    level8: 1
  spells:
    cantrips: ["acid_splash", "fire_bolt", "light", "mage_hand", "prestidigitation", "ray_of_frost"]
    level1: ["detect_magic", "magic_missile", "sleep", "witch_bolt"]
    level2: ["alter_self", "arcane_lock", "invisibility", "knock"]
    level3: ["counterspell", "dispel_magic", "fireball", "lightning_bolt"]
    level4: ["blight", "polymorph", "stoneskin"]
    level5: ["cloudkill", "geas", "scrying"]
    level6: ["true_seeing", "eyebite"]
    level7: ["finger_of_death", "plane_shift"]
    level8: ["power_word_stun"]

# === ACTIONS ===
actions:
  - name: "Multiattack"
    description: "Baba Lysaga makes three attacks with her quarterstaff or Arcane Bolt."
    mechanics:
      type: "multiattack"
      attacks: 3
      options: ["three_quarterstaff", "three_arcane_bolt", "mixed"]

  - name: "Quarterstaff"
    type: "melee_weapon_attack"
    attackBonus: 9  # +5 Str + 4 prof
    reach: 5
    targets: 1
    damage:
      dice: "1d6"
      bonus: 5  # Str modifier (one-handed)
      damageType: "bludgeoning"
    damageVersatile:
      dice: "1d8"
      bonus: 5  # Two-handed
    description: "Melee Weapon Attack: +9 to hit, reach 5 ft., one target. Hit: 8 (1d6 + 5) bludgeoning damage, or 10 (1d8 + 5) bludgeoning damage if used with two hands."

  - name: "Arcane Bolt"
    type: "ranged_spell_attack"
    attackBonus: 8  # +4 Cha + 4 prof
    range:
      normal: 120
      long: null
    targets: 1
    damage:
      dice: "3d10"
      bonus: 0
      damageType: "force"
    description: "Ranged Spell Attack: +8 to hit, range 120 ft., one target. Hit: 16 (3d10) force damage."

  - name: "Summon Swarms (Recharge 5-6)"
    description: "Baba Lysaga summons 1d4 swarms of insects (flies). The swarms appear in unoccupied spaces within 60 feet of Baba Lysaga and act as her allies. They remain for 1 minute or until Baba Lysaga dismisses them as an action."
    mechanics:
      type: "summon"
      recharge: [5, 6]
      summonType: "swarm_of_insects"
      quantity: "1d4"
      range: 60
      duration: "1_minute"
      control: true

  - name: "Creeping Hut Commands"
    description: "If Baba Lysaga is riding her Creeping Hut, she can command it to take any of its actions as a bonus action on her turn."
    mechanics:
      type: "companion_action"
      requirement: "riding_creeping_hut"
      actionCost: "bonus_action"
      effect: "creeping_hut_takes_any_action"

# === LEGENDARY ACTIONS ===
legendaryActions:
  actionsPerRound: 3
  description: "Baba Lysaga can take 3 legendary actions, choosing from the options below. Only one legendary action can be used at a time and only at the end of another creature's turn. Baba Lysaga regains spent legendary actions at the start of her turn."
  actions:
    - name: "Cantrip"
      cost: 1
      description: "Baba Lysaga casts a cantrip."

    - name: "Spell (Costs 2 Actions)"
      cost: 2
      description: "Baba Lysaga casts a spell of 5th level or lower using a spell slot."

    - name: "Blasphemous Word (Costs 3 Actions)"
      cost: 3
      description: "Baba Lysaga targets one creature she can see within 30 feet of her. The target must succeed on a DC 16 Wisdom saving throw or be stunned until the end of Baba Lysaga's next turn."
      mechanics:
        range: 30
        saveDC: 16
        saveAbility: "wisdom"
        onFailure: "stunned_until_end_of_next_turn"

# === LAIR ACTIONS ===
lairActions:
  initiative: 20  # Lair acts on initiative count 20
  description: "On initiative count 20 (losing initiative ties), Baba Lysaga can take a lair action to cause one of the following effects; she can't use the same effect two rounds in a row:"
  actions:
    - name: "Roots and Vines"
      description: "Grasping roots and vines erupt in a 20-foot radius centered on a point on the ground that Baba Lysaga can see within 120 feet of her. That area becomes difficult terrain, and each creature there must succeed on a DC 15 Strength saving throw or be restrained by the roots and vines. A creature can be freed if it or another creature takes an action to make a DC 15 Strength check and succeeds. The roots and vines wilt away when Baba Lysaga uses this lair action again or when she dies."
      mechanics:
        area: "20_ft_radius"
        range: 120
        saveDC: 15
        saveAbility: "strength"
        effect: "difficult_terrain_and_restrained"
        escape: "DC_15_strength_check_as_action"
        duration: "until_next_lair_action_or_death"

    - name: "Swarm of Insects"
      description: "Baba Lysaga summons a swarm of insects to attack one creature she can see within 60 feet of her. The swarm makes a melee attack (+3 to hit) against the target. On a hit, the target takes 10 (4d4) piercing damage."
      mechanics:
        range: 60
        attackBonus: 3
        damage:
          dice: "4d4"
          damageType: "piercing"

    - name: "Banshee Wail"
      description: "Baba Lysaga emits a terrible scream. Each creature within 30 feet of her that can hear her must succeed on a DC 16 Wisdom saving throw or be frightened of her until the end of her next turn."
      mechanics:
        area: "30_ft_radius"
        requirement: "target_can_hear"
        saveDC: 16
        saveAbility: "wisdom"
        onFailure: "frightened_until_end_of_next_turn"

# === REACTIONS ===
reactions:
  - name: "Counterspell"
    description: "When a creature Baba Lysaga can see within 60 feet of her casts a spell, Baba Lysaga can use her reaction to cast counterspell."
    mechanics:
      trigger: "creature_casts_spell_within_60_feet"
      effect: "cast_counterspell"

# === EQUIPMENT ===
equipment:
  - item: "quarterstaff"
    quantity: 1
  - item: "ring_of_protection"
    quantity: 1
    rarity: "rare"
    effect: "+1 AC and saves"
  - item: "heartstone"
    quantity: 1
    rarity: "very_rare"
  - item: "soul_bag"
    quantity: 1
    rarity: "very_rare"
    note: "Contains 3 evil souls"
  - item: "spellbook"
    quantity: 1
    note: "Contains all prepared spells"

# === LOOT ===
loot:
  guaranteed:
    - item: "ring_of_protection"
      quantity: 1
      rarity: "rare"
      value: "varies"
    - item: "heartstone"
      quantity: 1
      rarity: "very_rare"
      value: "priceless"
    - item: "soul_bag"
      quantity: 1
      rarity: "very_rare"
      note: "Contains 3 evil souls"
    - item: "spellbook"
      quantity: 1
      value: "500_gp"
    - item: "berez_gem"
      quantity: 1
      rarity: "artifact"
      note: "One of three gems from Argynvostholt (quest item)"
  conditional:
    - item: "potion_of_greater_healing"
      quantity: "1d4"
      dropChance: 80
    - item: "rare_spell_scroll"
      quantity: 1
      dropChance: 50

# === AI BEHAVIOR ===
aiBehavior:
  combatTactics: "Boss encounter - use all resources. RIDING CREEPING HUT: Command hut to attack as bonus action while casting spells. Open with Cloudkill or Fireball (8d6). Use Counterspell reaction to deny enemy spells. Legendary Actions: Cast cantrips (Fire Bolt 1d10) or spells of 5th level (Cone of Cold 8d8). Blasphemous Word (3 actions) to stun key targets (DC 16 Wisdom). Lair Actions (initiative 20): Roots/Vines to restrain, Swarm attacks, Banshee Wail to frighten. Summon Swarms (1d4 insect swarms) for minions. If below 50 HP, use Stoneskin. If below 20 HP and hut destroyed, use Etherealness to escape."
  intelligence: "genius"
  aggression: "high"  # Boss fight, no retreat until near death
  groupTactics: "solo_boss_with_hut"

  preferredTargets:
    - "spellcasters (Counterspell, Blasphemous Word)"
    - "high-damage dealers"
    - "clusters (Fireball, Cloudkill)"

  fleeThreshold: 20  # HP threshold
  fleeConditions: ["creeping_hut_destroyed", "below_15_percent_hp", "party_has_holy_symbol_of_ravenkind"]

# === ECOLOGY & LORE ===
ecology:
  environment: "Berez ruins (U-shaped goat pen), Creeping Hut lair"
  organization: "Solitary (unique boss)"

lore:
  description: "Baba Lysaga is a supremely powerful witch who claims to be Strahd von Zarovich's true mother. In truth, she was the nurse who cared for Strahd as a child and became obsessed with him. When Strahd's mother Queen Ravenovia exiled her, Baba Lysaga swore eternal vengeance. She dwells in the ruined village of Berez, guarding one of the three legendary gems from Argynvostholt. Baba Lysaga has embraced dark powers, transforming herself into a night hag-like creature of immense magical power. She rides a terrifying Creeping Hut - an animated structure with chicken-like legs that can trample enemies. She serves Strahd zealously, believing herself to be his true parent and protector."
  weakness: "Destroying the Creeping Hut significantly reduces her combat power (loses bonus action attacks and mobility). Silvered weapons bypass resistances. Holy symbols and radiant damage effective against fiends. Counterspell can be countered by another Counterspell. Limited high-level spell slots (1x 7th, 1x 8th)."
  behavior: "Fanatically loyal to Strahd. Extremely intelligent and cunning. Uses Creeping Hut for mobility and devastating attacks. Prioritizes eliminating spellcasters with Counterspell and Blasphemous Word. Controls battlefield with lair actions (roots/vines to restrain, swarms to harass). Legendary actions to maintain pressure every round. Will fight to the death to protect Berez gem. Hates ravens and wereravens (Keepers of the Feather) with obsessive passion."

# === ENCOUNTER DESIGN ===
encounterNotes:
  recommendedPartyLevel: 9
  encounterSize: "Baba Lysaga + Creeping Hut (combined CR 12-13 effective)"
  terrain: "Berez ruins, U-shaped goat pen lair with muddy ground (difficult terrain), standing stones"
  tactics: "RETURN BEREZ GEM QUEST (Story 4-13): Deadly boss encounter. Baba Lysaga rides Creeping Hut (50 ft fly speed). Hut attacks as bonus action (2d10+4 bludgeoning, DC 15 Dex save or knocked prone). Lair actions on initiative 20: Roots/Vines (restrain DC 15), Swarm attacks (4d4 piercing), Banshee Wail (frighten DC 16). Legendary actions: Cantrip (Fire Bolt), Spell (Fireball 8d6, Blight 8d8), Blasphemous Word (stun DC 16). Summon Swarms (1d4 insect swarms) for added threats. Counterspell reaction shuts down enemy magic. If hut destroyed, she's significantly weaker but still dangerous. Environmental hazards: Muddy ground (difficult terrain), animated scarecrows (minions), magic circle trap."

# === COMPANION CREATURE ===
companionCreature:
  name: "Creeping Hut"
  monsterId: "creeping_hut"
  description: "Baba Lysaga's animated hut with giant chicken legs. Acts on Baba Lysaga's turn as bonus action commands."
  size: "Gargantuan"
  type: "construct"
  armorClass: 16
  hitPoints: 90
  speed:
    walk: 30
    fly: 50
  abilities:
    strength: 20  # +5
    dexterity: 10  # +0
  actions:
    - name: "Trample"
      attackBonus: 9
      reach: 10
      damage:
        dice: "2d10"
        bonus: 4
        damageType: "bludgeoning"
      additionalEffect: "DC 15 Dex save or knocked prone"
  traits:
    - name: "Construct Nature"
      description: "The hut doesn't require air, food, drink, or sleep. Immune to poison and psychic damage. Immune to charmed, frightened, paralyzed, poisoned conditions."

# === SOURCE & METADATA ===
metadata:
  source: "Curse of Strahd"
  pageReference: "CoS p.228 (Berez, Chapter 10)"
  official: true
  srdContent: false

  notes: "PRIORITY 1 BOSS for Return Berez Gem quest (Story 4-13). CR 11 deadly encounter for level 9 party. Effective CR 12-13 when combined with Creeping Hut. Boss has legendary actions (3/round) and lair actions (initiative 20). Counterspell reaction makes her extremely dangerous to magic users. Berez gem is one of three artifacts needed for final confrontation with Strahd. Defeating Baba Lysaga is major story milestone."

  dmReminders:
    - "BOSS ENCOUNTER: Legendary actions (3/round), Lair actions (initiative 20)"
    - "Riding Creeping Hut: Command hut attacks as bonus action (2d10+4, DC 15 Dex or prone)"
    - "Multiattack: 3 attacks (quarterstaff or Arcane Bolt 3d10 force)"
    - "Legendary Actions: Cantrip (1), Spell 5th level (2), Blasphemous Word stun (3)"
    - "Lair Actions: Roots/Vines restrain DC 15, Swarm 4d4, Banshee Wail frighten DC 16"
    - "Counterspell REACTION - can shut down enemy spells"
    - "Summon Swarms (Recharge 5-6): 1d4 insect swarms"
    - "16th-level spellcaster: Fireball (8d6), Cloudkill (5d8), Finger of Death (7d8+30)"
    - "Magic Resistance: Advantage on saves vs spells"
    - "Berez gem: Quest item, must be retrieved"
    - "Destroy Creeping Hut first to reduce her combat effectiveness"
    - "Hates wereravens - if Keepers of Feather aided party, she's enraged"

  developmentStage: "final"

# === TEMPLATE VERSION ===
templateVersion: "1.0.0"
compatibleWith: "Epic 3 CombatManager (Story 3-5)"
